<link rel="import" href="../bower_components/polymer/polymer.html">
<dom-module id="ws-element">
	<template>
		<style>
			:host {
				display: none;
			}
		</style>
	</template>
</dom-module>
<script type="text/javascript">
       Polymer({
           is: "ws-element",
           socket: null,
           properties: {
               url: {
                   type: String
               },
               state: {
               	type: Number,
               	notify: true,
               	reflectToAttribute: true
               }
           },
           ready: function () {
               this.socket = new WebSocket(this.url);
               this.socket.onerror = this.onError.bind(this);
               this.socket.onopen = this.onOpen.bind(this);
               this.socket.onmessage = this.onMessage.bind(this);
           },
           onError: function (error) {
               this.fire('onerror', error);
           },
           onOpen: function (event) {
               this.set('state', 1)
               this.socket.send( JSON.stringify({
            	   website: nativeDomain()
               }));
           },
           onMessage: function (event) {
        	   var data = JSON.parse(event.data)
               document.querySelector('my-app').dispatchEvent(new CustomEvent('onmessage', {detail: data} ));
           },
           send: function (message) {
               this.socket.send(message);
           },
           close: function () {
               this.set('state', 3)
               
           }
	});
</script>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">

<script src="../node_modules/redux/dist/redux.js"></script>

<script> 	    
 const reducer = (state, action) => {
	  switch (action.type) {
	    case 'UPDATE_SELECTED':
	      return Object.assign({}, state, {
	        	selected: action.selected
	      });
	    case 'UPDATE_CURATORS':
	      return Object.assign({}, state, {
	        	curators: action.curators
	    });
	    case 'UPDATE_LEAGUES':
	      return Object.assign({}, state, {
	    	  leagues: action.leagues
	    });		      
	    case 'UPDATE_OPERATORS':
		      return Object.assign({}, state, {
		    	  operators: action.operators
		    });	      
	    case 'WEBSOCKET_MESSAGE':
	    	 if ( action.message.twitter ) {	    		 
				  const tweets = state.tweets.splice(0)
				  if (typeof action.message.limit !== 'undefined' ) {
					  console.log('limit message:', action.message.limit, action.message.twitter)
					  tweets.push(action.message)  
				  } else if (typeof action.message.twitter !== 'undefined' ) {
					  console.log('new message:', action.message)
					  tweets.unshift(action.message)
				  } else {
					  console.log('heartbeat');
					  return state;
				  }
			      return Object.assign({}, state, { tweets });	    		 
	    	 }
	    	 return state;
	    case 'WEBSOCKET_REQUEST':
	    	const requests = state.requests.splice(0)
			requests.push(action.request)	    	 			      
	    	return Object.assign({}, state, { requests });
	    case 'WEBSOCKET_READY':
	    	 return Object.assign({}, state, { readyState: action.readyState });	    	 
	    default:
	      return state;
	  }
	};
 
 const store = Redux.createStore(reducer, {
	site: nativeDomain(),
	lingo: JSON.parse(document.querySelector('meta[name="lingo"]').getAttribute('content')),
	selected: 0,
	menu: [{name: 'Throughput'}, {name: 'Entities'}, {name: 'Stream'}, {name: 'Systems'}, {name: 'Match'}],
	tweets: [],
	requests: [],
	curators: [],
	leagues: [],
	opertors: [],
 });	            
 const ReduxMixin = PolymerRedux(store)
    
 const SelectedMixin = Parent => class SelectedMixin extends ReduxMixin(Parent) {
    
	static get properties() {
      return {
        selected: {
          type: Number,
          statePath: 'selected'
        }
      }
    }
    
    static get actions() {
       return {
        updateSelected(selected) {
           return {
             type: 'UPDATE_SELECTED',
             selected
           };
         }
       };
     }  
    
    updateSelected(selected) {
       if (store.getState().selected != selected) {
     	   this.dispatch('updateSelected', selected)   
       }       
    }    
  } 
</script>

